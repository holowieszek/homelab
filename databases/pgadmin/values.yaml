app-template:
  controllers:
    main:
      replicas: 1
      containers:
        main:
          image:
            repository: docker.io/dpage/pgadmin4
            tag: latest
          env:
            PGADMIN_DEFAULT_EMAIL: test@example.com
            PGADMIN_DEFAULT_PASSWORD: testpassword
          securityContext:
            allowPrivilegeEscalation: true
            runAsUser: 0
            runAsGroup: 0
      # initContainers:
      #   - name: pgadmin-data-permission-fix
      #     image:
      #       repository: busybox
      #       tag: latest
      #     command: ["/bin/chown", "-R", "5050:5050", "/var/lib/pgadmin"]
      #     volumeMounts:
      #       - name: pgadminstorage
      #         mountPath: /var/lib/pgadmin

  service:
    main:
      ports:
        http:
          port: 80
          protocol: HTTP

  ingress:
    main:
      enabled: true
      className: traefik
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        kubernetes.io/ingress.class: "traefik"
      hosts:
        - host: pgadmin.internal.mateuszholowieszko.com
          paths:
            - path: /
              pathType: Prefix
              service:
                name: main
                port: http
      tls:
        - hosts:
            - pgadmin.internal.mateuszholowieszko.com
          secretName: pgadmin-internal-mateuszholowieszko-com-tls

  podSecurityContext:
    allowPrivilegeEscalation: true
    runAsUser: 0
    runAsGroup: 0
    fsGroup: 0
    # fsGroupChangePolicy: OnRootMismatch

  persistence:
    data:
      enabled: true
      type: persistentVolumeClaim
      accessMode: ReadWriteOnce
      storageClass: longhorn
      size: 1Gi
      advancedMounts:
        main:
          main:
            - path: /var/lib/pgadmin
              # subPath: pgadmin

    # data:
    #   accessMode: ReadWriteOnce
    #   advancedMounts:
    #     main:
    #       main:
    #         - path: /var/lib/pgadmin
    #           subPath: pgadmin
